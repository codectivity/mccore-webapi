<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - MCCore Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
        }
        .nav-glass {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        .card-glass {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .input-field {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: border-color 0.2s ease;
        }
        .input-field:focus {
            border-color: #ffffff;
            outline: none;
        }
    </style>
</head>
<body class="min-h-screen bg-black text-white">
    <!-- Navigation -->
    <nav class="nav-glass border-b border-gray-800 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-8">
                    <div class="flex items-center space-x-2">
                        <svg width="32" height="32" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_1_27)">
                                <path d="M378.304 430.668C380.765 434.183 379.918 439.04 376.319 441.377C344.38 462.107 307.585 474.258 269.492 476.588C228.81 479.076 188.233 470.266 152.247 451.131C116.26 431.997 86.2659 403.284 65.58 368.166C44.8941 333.048 34.3224 292.894 35.0337 252.143C35.745 211.392 47.7116 171.631 69.6105 137.257C91.5094 102.882 122.488 75.2333 159.12 57.3665C195.752 39.4997 236.612 32.111 277.182 36.0174C315.17 39.6753 351.519 53.1033 382.715 74.9354C386.231 77.3959 386.908 82.2798 384.325 85.7069C381.743 89.134 376.879 89.8055 373.357 87.3544C344.455 67.2419 310.828 54.8689 275.693 51.4857C237.976 47.854 199.989 54.7231 165.932 71.3336C131.876 87.9441 103.076 113.649 82.7167 145.606C62.3576 177.564 51.2325 214.529 50.5712 252.414C49.9099 290.3 59.7382 327.631 78.9696 360.279C98.2009 392.927 126.086 419.622 159.542 437.411C192.998 455.2 230.722 463.39 268.543 461.077C303.775 458.922 337.813 447.73 367.399 428.639C371.005 426.312 375.842 427.153 378.304 430.668Z" fill="#D9D9D9"/>
                                <circle cx="361.838" cy="255.838" r="149.838" fill="#D9D9D9"/>
                            </g>
                            <defs>
                                <clipPath id="clip0_1_27">
                                    <rect width="512" height="512" fill="white"/>
                                </clipPath>
                            </defs>
                        </svg>
                        <span class="text-lg font-semibold">MCCore</span>
                    </div>
                    <div class="hidden md:flex items-center space-x-6">
                        <a href="/" class="text-gray-300 hover:text-white transition-colors">Dashboard</a>
                        <a href="/keys" class="text-gray-300 hover:text-white transition-colors">API Keys</a>
                        <a href="/assets" class="text-gray-300 hover:text-white transition-colors">Launchers</a>
                        <a href="/java" class="text-white">Java</a>
                        <a href="/news" class="text-gray-300 hover:text-white transition-colors">News</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/logout" class="text-gray-400 hover:text-white transition-colors">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-12">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold mb-2">Java Configuration</h1>
                <p class="text-gray-400">Configure Java runtime versions for launcher clients</p>
            </div>
            <button 
                onclick="showConfigModal()"
                class="px-6 py-3 bg-white text-black rounded-md hover:bg-gray-100 transition-colors"
            >
                Update Config
            </button>
        </div>

        <!-- Current Configuration -->
        <div class="card-glass rounded-lg p-6">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                        <i class="fas fa-coffee text-yellow-400"></i>
                    </div>
                    <div>
                        <h2 class="text-lg font-semibold">Current Java Configuration</h2>
                        <p class="text-sm text-gray-400">Runtime configuration for launcher clients</p>
                    </div>
                </div>
            </div>
            <div id="javaConfig" class="space-y-4">
                <!-- Configuration will be loaded here via JavaScript -->
            </div>
        </div>

        <!-- Configuration Modal -->
        <div id="configModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50">
            <div class="relative top-20 mx-auto p-6 border w-full max-w-md shadow-2xl rounded-lg bg-gray-900 border-gray-700">
                <div class="mb-6">
                    <h3 class="text-xl font-bold mb-2">Update Java Configuration</h3>
                    <p class="text-gray-400 text-sm">Configure Java runtime settings for launcher clients</p>
                </div>
                <form id="configForm">
                    <div class="mb-6">
                        <label for="source" class="block text-sm font-medium text-gray-300 mb-2">Source</label>
                        <select 
                            id="source" 
                            name="source"
                            class="input-field w-full px-4 py-3 rounded-md text-white"
                            required
                        >
                            <option value="Codectivity-cdn">Codectivity CDN</option>
                            <option value="custom">Custom Configuration</option>
                        </select>
                    </div>
                    <div class="mb-6" id="customDataSection" style="display: none;">
                        <label for="javaData" class="block text-sm font-medium text-gray-300 mb-2">Custom Java Data (JSON)</label>
                        <textarea 
                            id="javaData" 
                            name="java_data"
                            rows="10"
                            placeholder='{"versions": [{"id": "17", "url": "https://example.com/java17.zip"}]}'
                            class="input-field w-full px-4 py-3 rounded-md text-white placeholder-gray-400 font-mono text-sm"
                        ></textarea>
                        <p class="text-xs text-gray-500 mt-2">Enter valid JSON configuration for Java versions</p>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button 
                            type="button"
                            onclick="hideConfigModal()"
                            class="px-6 py-3 text-gray-300 border border-gray-600 rounded-md hover:bg-gray-800 transition-colors"
                        >
                            Cancel
                        </button>
                        <button 
                            type="submit"
                            class="px-6 py-3 bg-white text-black rounded-md hover:bg-gray-100 transition-colors"
                        >
                            Update Config
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
        function showConfigModal() {
            document.getElementById('configModal').classList.remove('hidden');
        }

        function hideConfigModal() {
            document.getElementById('configModal').classList.add('hidden');
        }

        function toggleCustomDataSection() {
            const source = document.getElementById('source').value;
            const customSection = document.getElementById('customDataSection');
            
            if (source === 'custom') {
                customSection.style.display = 'block';
            } else {
                customSection.style.display = 'none';
            }
        }

        async function loadJavaConfig() {
            try {
                const response = await fetch('/v1/admin/java', {
                    headers: {
                        'Authorization': 'Bearer <%= apiKey %>'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayJavaConfig(data.asset);
                } else if (response.status === 404) {
                    // No Java configuration exists yet
                    displayJavaConfig(null);
                } else {
                    console.error('Failed to load Java config');
                    document.getElementById('javaConfig').innerHTML = '<p class="text-red-500">Failed to load Java configuration</p>';
                }
            } catch (error) {
                console.error('Error loading Java config:', error);
                document.getElementById('javaConfig').innerHTML = '<p class="text-red-500">Error loading Java configuration</p>';
            }
        }

        function displayJavaConfig(config) {
            const container = document.getElementById('javaConfig');
            
            if (!config || Object.keys(config).length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-20 h-20 bg-yellow-500/20 rounded-lg flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-coffee text-yellow-400 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">No Java Configuration</h3>
                        <p class="text-gray-400 mb-4">No Java configuration has been set up yet</p>
                        <p class="text-sm text-gray-500">Click "Update Config" to create a new Java configuration</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="space-y-6">';
            
            if (config.source) {
                html += `
                    <div class="flex items-center justify-between p-6 bg-black/20 rounded-lg border border-gray-700">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-coffee text-yellow-400"></i>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold">Source</h4>
                                <p class="text-gray-400">${config.source}</p>
                            </div>
                        </div>
                        <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full ${config.source === 'Codectivity-cdn' ? 'bg-blue-500/20 text-blue-400' : 'bg-purple-500/20 text-purple-400'}">
                            ${config.source === 'Codectivity-cdn' ? 'CDN' : 'Custom'}
                        </span>
                    </div>
                `;
            }

            if (config.java_data && config.java_data.versions && Array.isArray(config.java_data.versions)) {
                html += '<div>';
                html += '<h4 class="text-lg font-semibold mb-4">Available Java Versions</h4>';
                html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
                
                config.java_data.versions.forEach(version => {
                    html += `
                        <div class="p-6 bg-black/20 rounded-lg border border-gray-700 hover:bg-black/30 transition-colors">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-code text-green-400"></i>
                                    </div>
                                    <div>
                                        <h5 class="font-semibold">Java ${version.id}</h5>
                                        <p class="text-xs text-gray-400">${version.type || 'Runtime'}</p>
                                    </div>
                                </div>
                            </div>
                            <p class="text-sm text-gray-400 break-all">${version.url || 'No URL'}</p>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }

            html += '</div>';
            container.innerHTML = html;
        }

        async function updateJavaConfig(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            
            const config = {
                source: formData.get('source')
            };

            if (config.source === 'custom') {
                try {
                    const javaData = formData.get('java_data');
                    if (javaData) {
                        JSON.parse(javaData); // Validate JSON
                        config.java_data = JSON.parse(javaData);
                    }
                } catch (error) {
                    alert('Invalid JSON format in custom Java data');
                    return;
                }
            }
            
            try {
                const response = await fetch('/v1/admin/java', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer <%= apiKey %>'
                    },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    hideConfigModal();
                    event.target.reset();
                    loadJavaConfig();
                    alert('Java configuration updated successfully!');
                } else {
                    const error = await response.json();
                    alert('Failed to update Java config: ' + error.message);
                }
            } catch (error) {
                console.error('Error updating Java config:', error);
                alert('Failed to update Java configuration');
            }
        }

        // Load Java config on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadJavaConfig();
            document.getElementById('configForm').addEventListener('submit', updateJavaConfig);
            document.getElementById('source').addEventListener('change', toggleCustomDataSection);
        });
    </script>
</body>
</html> 